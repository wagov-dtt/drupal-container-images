{
  "$schema": "https://schema.railpack.com",
  "buildAptPackages": [
    "default-mysql-client"
  ],
  "deploy": {
    "base": {
      "step": "patched-os"
    },
    "paths": [
      "/app/vendor/bin"
    ]
  },
  "steps": {
    "patched-os": {
      "inputs": [
        {
          "image": "dunglas/frankenphp:1-php8.4-trixie"
        }
      ],
      "commands": [
        "apt-get update && DEBIAN_FRONTEND=noninteractive apt-get upgrade -yq && apt-get clean && rm -rf /var/lib/apt/lists/*"
      ]
    },
    "install:composer": {
      "variables": {
        "COMPOSER_MEMORY_LIMIT": "-1"
      },
      "commands": [
        {
          "image": "composer:latest",
          "src": "/usr/bin/composer",
          "dest": "/usr/bin/composer"
        },
        {
          "src": "composer.json",
          "dest": "composer.json"
        },
        {
          "src": "composer.lock",
          "dest": "composer.lock"
        },
        {
          "cmd": "composer install --ansi --no-interaction --no-scripts --optimize-autoloader --prefer-dist",
          "customName": "Run composer install."
        }
      ]
    },
    "prepare": {
      "variables": {
        "SERVER_NAME": ":80",
        "SERVER_ROOT": "/app/web"
      }
    },
    "build": {
      "commands": [
        "...",
        {
          "cmd": "ln -sf /app /var/www/html",
          "customName": "Make symbolic link from /var/www/html to /app folder."
        },
        {
          "src": "Caddyfile",
          "dest": "/Caddyfile"
        }
      ]
    }
  }
}
