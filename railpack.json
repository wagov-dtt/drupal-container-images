{
  "$schema": "https://schema.railpack.com",
  "deploy": {
    "aptPackages": [
      "default-mysql-client"
    ]
  },
  "steps": {
    "install:composer": {
      "variables": {
        "COMPOSER_MEMORY_LIMIT": "-1"
      },
      "commands": [
        {
          "image": "composer:latest",
          "src": "/usr/bin/composer",
          "dest": "/usr/bin/composer"
        },
        {
          "src": "composer.json",
          "dest": "composer.json"
        },
        {
          "src": "composer.lock",
          "dest": "composer.lock"
        },
        {
          "cmd": "composer install --ansi --no-interaction --no-scripts --optimize-autoloader --prefer-dist",
          "customName": "Run composer install."
        },
        {
          "cmd": "pnpm run dist",
          "customName": "Rebuild theme CSS/JS assets by running 'dist' script."
        }
      ]
    },
    "prepare": {
      "variables": {
        "SERVER_NAME": ":80",
        "SERVER_ROOT": "/app/web"
      }
    },
    "build": {
      "commands": [
        "...",
        {
          "cmd": "ln -sf /app /var/www/html",
          "customName": "Make symbolic link from /var/www/html to /app folder."
        },
        {
          "src": "Caddyfile",
          "dest": "/Caddyfile"
        }
      ]
    }
  }
}
