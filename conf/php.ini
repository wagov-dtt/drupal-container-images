;; Based on https://github.com/php/php-src/blob/master/php.ini-production
;; ========================================================================
;; Minimal PHP CLI Configuration for Drupal / Drush (Immutable Container)
;; ========================================================================

[PHP]
; --- Essential Memory & Execution ---
; Drush commands require heavy memory. 
; -1 removes limits, 0 prevents timeouts.
memory_limit = -1
max_execution_time = 0

; --- CLI Argument Parsing ---
; CRITICAL FOR DRUSH: Enables PHP to read command-line arguments and flags.
register_argc_argv = On

; --- Environment Variables ---
; CRITICAL FOR CONTAINERS: Ensures Drush reads ENV variables (the 'E').
variables_order = "EGPCS"

; --- Error Handling ---
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
display_errors = Off
display_startup_errors = Off
log_errors = On

; --- File Uploads ---
; Unlimited for local/CLI import scripts
post_max_size = 0
upload_max_filesize = 0


;; ========================================================================
;; OpCache Tuning for Drupal CLI Performance
;; ========================================================================

[opcache]
; --- The Master Switch ---
; CRITICAL: Without this, Drush gets zero OpCache benefits.
opcache.enable_cli = 1

; --- Immutable Container Optimization ---
; CRITICAL FOR PERFORMANCE: Since code is baked in and doesn't change, 
; this prevents PHP from constantly checking the filesystem for modifications.
opcache.validate_timestamps = 0

; --- Memory & Capacity Tuning for Drupal ---
; Accommodates Drupal core + vendor directory size.
opcache.memory_consumption = 512
opcache.max_accelerated_files = 65407
opcache.interned_strings_buffer = 32

; --- Drupal Specific Requirement ---
; CRITICAL: Drupal Plugin discovery relies on DocBlock annotations.
opcache.save_comments = 1
